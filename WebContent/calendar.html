<!DOCTYPE html>
<html lang='ko'>
  <head>
    <meta charset='utf-8' />
    <script>
      /* ì—…ë¡œë“œ ì²´í¬ */
      function fileCheck( file )
      {
        // ì‚¬ì´ì¦ˆì²´í¬
        var maxSize  = 5 * 1024 * 1024    //30MB
        var fileSize = 0;
        // ë¸Œë¼ìš°ì € í™•ì¸
        var browser=navigator.appName;     
        // ìµìŠ¤í”Œë¡œëŸ¬ì¼ ê²½ìš°
        if (browser=="Microsoft Internet Explorer")
        {
          var oas = new ActiveXObject("Scripting.FileSystemObject");
          fileSize = oas.getFile( file.value ).size;
        }
        // ìµìŠ¤í”Œë¡œëŸ¬ê°€ ì•„ë‹ê²½ìš°
        else
        {
          fileSize = file.files[0].size;
        }
        if(fileSize > maxSize)
        {
            alert("ì²¨ë¶€íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 5MB ì´ë‚´ë¡œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.    ");
            return false;
        }else{
          return true;
        }
      }
    </script>
    <script>
      $(function() {
        var loginedId = localStorage.getItem('id');
        $.ajax({
          url: "./annualleave",
          success: function(responseObj){
            localStorage.setItem("used_day", responseObj.used_day);
          }
        });

        var calendarEl = document.getElementById('calendar');
        // var statusArr = ["1","2","3"]; // ê°œì¸ì¼ì • 1-ì—…ë¬´, 2-ì¶œì¥, 3-ì—°ì°¨
        var checkedArr = ["1","1","1","1","1"]; // ë°•ìŠ¤ ì²´í¬ ë˜ì—ˆëŠ”ì§€ (1ì´ë©´ true 2ë©´ false)
        var empcheckedArr = ["1","1","1"];
        var filepath = "";
        var filename = "";
        var textColor = 'white';
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'ko',
          selectable: true,
          dayMaxEventRows : true,
          eventDisplay: 'block', //ëª¨ë“  ì´ë²¤íŠ¸ ë¸”ë¡í‘œì‹œ
          // contentHeight: "auto",
          // aspectRatio : 1.35,
          // handleWindowResize : false,

          //ì¼ì •ì¶”ê°€ ë²„íŠ¼
          customButtons: {
            addEventButton: {
              text: 'ì¼ì •ì¶”ê°€',
              click: function() {
                $("#newScheduleForm")[0].reset();
                $(".trigger").val(0);
                var d = new Date();
                var month;
                var day;
                //í•¨ìˆ˜ë¡œ ë¬¶ê¸°
                if((d.getMonth()+1)<10){
                  var month = '0'+(d.getMonth()+1);
                }else{
                  month = d.getMonth()+1
                }
                if((d.getDate())<10){
                  var day = '0'+(d.getDate());
                }else{
                  day = d.getDate();
                }
                if((d.getHours()+1)<10){
                  var startHours = '0'+(d.getHours()+1);
                }else{
                  startHours = d.getHours()+1
                }
                if((d.getHours()+2)<10){
                  var endHours = '0'+(d.getHours()+2);
                }else{
                  endHours = d.getHours()+2
                }
                if(startHours >= 24){
                  startHours -= 24;
                  startHours = '0' + startHours;
                }
                if(endHours >= 24){
                  endHours -= 24;
                  endHours = '0' + endHours;
                }
                var str = d.getFullYear()+'-'+month+'-'+day;
                $("input[name=newScheduleStartDate]").val(str);
                $("input[name=newScheduleStartTime]").val(startHours+":00");
                $("input[name=newScheduleEndDate]").val(str);
                $("input[name=newScheduleEndTime]").val(endHours+":00");
                $("#statusBox").val("1").prop("selected", true);
                $("#statusBox>.employeeStatus").removeAttr('disabled');
                $("#statusBox>.departmentStatus").removeAttr('disabled');
                $('#element_to_pop_up').bPopup({
                  modalClose: false,
                });
              }
            }
          },
          // ì¼ì •ì¶”ê°€ ë²„íŠ¼

          headerToolbar:{
            left:'today',
            center: 'title',
            right:'addEventButton prev next'
          },
          dayHeaderDidMount : function (e){
            $(e.el).css('background-color', '#f1f1f1');
            if(e.text == 'ì¼'){
              $(e.el).css('color', 'red');
            }
          },
          dayCellContent: function (e) { //ë‚ ì§œì— ì¼ ë¶™ëŠ”ê±° ì‚­ì œ
            e.dayNumberText = e.dayNumberText.replace ('ì¼','');
          },
          dayCellDidMount: function (e) {
            if(e.date.getDay() == 0){
              $(e.el).css('color', 'red');
            }
          },
		  
          //ë‹¬ë ¥ì— í‘œì‹œë  ëª¨ë“  ì´ë²¤íŠ¸ë“¤
          eventSources: [
            {
              events : function(info, successCallback, failureCallback){ //ê°œì¸ì¼ì •
                $.ajax({
                  url:"./viewempevent",
                  // traditional : true, //ë°°ì—´ê°’ì„ ìë°”ì— ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤
                  data : {"status" : "1", "checked" : empcheckedArr[0]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color : '#d1bd08',
              textColor: textColor,
              id : "1",
            },

            {
              events : function(info, successCallback, failureCallback){ //ê°œì¸ì¼ì •
                $.ajax({
                  url:"./viewempevent",
                  data : {"status" : "2", "checked" : empcheckedArr[1]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color : '#d1bd08',
              textColor: textColor,
              id : "2",
            },

            {
              events : function(info, successCallback, failureCallback){ //ê°œì¸ì¼ì •
                $.ajax({
                  url:"./viewempevent",
                  data : {"status" : "3", "checked" : empcheckedArr[2]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color : '#d1bd08',
              textColor: textColor,
              id : "3",
            },

            {
              events : function(info, successCallback, failureCallback){ //ë¶€ì„œì¼ì •
                $.ajax({
                  url:"./viewdeptevent",
                  data : {"dept_id" : "1000", "checked" : checkedArr[0]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color: '#3f7f00',
              textColor: textColor,
              id : "1000",
            },

            {
              events : function(info, successCallback, failureCallback){ //ë¶€ì„œì¼ì •
                $.ajax({
                  url:"./viewdeptevent",
                  data : {"dept_id" : "2000", "checked" : checkedArr[1]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color: '#005fbf',
              textColor: textColor,
              id : "2000",
            },

            {
              events : function(info, successCallback, failureCallback){ //ë¶€ì„œì¼ì •
                $.ajax({
                  url:"./viewdeptevent",
                  data : {"dept_id" : "3000", "checked" : checkedArr[2]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color: '#cc5dd7',
              textColor: textColor,
              id : "3000",
            },

            {
              events : function(info, successCallback, failureCallback){ //ë¶€ì„œì¼ì •
                $.ajax({
                  url:"./viewdeptevent",
                  data : {"dept_id" : "4000", "checked" : checkedArr[3]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color: '#ff9364',
              textColor: textColor,
              id : "4000",
            },

            {
              events : function(info, successCallback, failureCallback){ //ë¶€ì„œì¼ì •
                $.ajax({
                  url:"./viewdeptevent",
                  data : {"dept_id" : "5000", "checked" : checkedArr[4]},
                  success : function(responseObj){
                    successCallback(responseObj);
                  },
                  error : function(jqXHR){
                	  alert("ì˜¤ë¥˜ : " + jqXHR.status);
                  }
                });
              },
              color: '#52d49a',
              textColor: textColor,
              id : "5000",
            },

          ],
          // ì´ë²¤íŠ¸ ì„ ì–¸ ë


          eventContent: function(info) {
        	/*
            var String = "";
            if(info.event.source.id == "1" || info.event.source.id == "2" || info.event.source.id == "3"){
              String = "[" + info.event.extendedProps.status_name + "]" + " " + info.timeText;
              info.timeText = String;
            }else{
              String = "[" + info.event.extendedProps.dept_name + "]" + " " + info.timeText;
              info.timeText = String;
            }
            */
            var String = "";
        	if(info.event.extendedProps.emp_id == loginedId){
        		String = "ğŸ™‹â€â™‚ï¸"+ info.timeText;
        		info.timeText = String;
        	}
          },


          eventDidMount: function(info) { //DOMì— ì´ë²¤íŠ¸ ì¶”ê°€ë˜ë©´
            // console.log(info.event.id);
            // console.log(info.event.extendedProps.name);
            // {description: "Lecture", department: "BioChemistry"}
            // var tooltip = new Tooltip(info.el, {
            //   title: info.event.extendedProps.description,
            //   placement: 'top',
            //   trigger: 'hover',
            //   container: 'body'
            // });
          },

          // ì´ë²¤íŠ¸ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ
          eventMouseEnter : function(info) { 
            $(info.el).css('cursor', 'pointer');

            // var tooltip = new Tooltip(info.el, {
            //   title: info.event.extendedProps.content,
            //   placement: 'top',
            //   trigger: 'hover',
            //   container: 'body'
            // });
          },

          //ì…€ í•œê°œê°€ í´ë¦­ë¬ì„ ë•Œ
          dateClick: function(info) { 
            $("#newScheduleForm")[0].reset();
            $(".trigger").val(0);
            var d = new Date();
            if((d.getHours()+1)<10){
              var startHours = '0'+(d.getHours()+1);
            }else{
              startHours = d.getHours()+1
            }
            if((d.getHours()+2)<10){
              var endHours = '0'+(d.getHours()+2);
            }else{
              endHours = d.getHours()+2
            }
            if(startHours >= 24){
              startHours -= 24;
              startHours = '0' + startHours;
            }
            if(endHours >= 24){
              endHours -= 24;
              endHours = '0' + endHours;
            }
            $("input[name=newScheduleStartDate]").val(info.dateStr);
            $("input[name=newScheduleStartTime]").val(startHours+":00");
            $("input[name=newScheduleEndDate]").val(info.dateStr);
            $("input[name=newScheduleEndTime]").val(endHours+":00");
            $("#statusBox").val("1").prop("selected", true);
            $("#statusBox>.employeeStatus").removeAttr('disabled');
            $("#statusBox>.departmentStatus").removeAttr('disabled');
            $('#element_to_pop_up').bPopup({
              modalClose: false,
            });
          },
          //ì…€ í•œê°œ í´ë¦­ ë

          //ì…€ì„ í•œê°œ í˜¹ì€ ì—¬ëŸ¬ê°œ ì„ íƒí–ˆì„ ë•Œ
          select: function(info) {
            $("#newScheduleForm")[0].reset();
            $(".trigger").val(0);
            //í•¨ìˆ˜ë¡œ ë¬¶ê¸°
            var d = new Date();
            if((d.getHours()+1)<10){
              var startHours = '0'+(d.getHours()+1);
            }else{
              startHours = d.getHours()+1
            }
            if((d.getHours()+2)<10){
              var endHours = '0'+(d.getHours()+2);
            }else{
              endHours = d.getHours()+2
            }
            if((info.end.getUTCMonth()+1)<10){
              var endMonth = '0'+(info.end.getUTCMonth()+1);
            }else{
              endMonth = info.end.getUTCMonth()+1
            }
            if((info.end.getUTCDate())<10){
              var endDate = '0'+(info.end.getUTCDate());
            }else{
              endDate = info.end.getUTCDate();
            }
            if(startHours >= 24){
              startHours -= 24;
              startHours = '0' + startHours;
            }
            if(endHours >= 24){
              endHours -= 24;
              endHours = '0' + endHours;
            }
            var endString = info.end.getFullYear()+"-"+endMonth+"-"+endDate;
            $("input[name=newScheduleStartDate]").val(info.startStr);
            $("input[name=newScheduleStartTime]").val(startHours+":00");
            $("input[name=newScheduleEndDate]").val(endString);
            $("input[name=newScheduleEndTime]").val(endHours+":00");
            $("#statusBox").val("1").prop("selected", true);
            $("#statusBox>.employeeStatus").removeAttr('disabled');
            $("#statusBox>.departmentStatus").removeAttr('disabled');
            $('#element_to_pop_up').bPopup({
              modalClose: false,
            });
          },
          // ì…€ ì„ íƒ ë

          // ì´ë²¤íŠ¸ í´ë¦­ë¬ì„ ë•Œ
          eventClick: function(info){ 
            // console.log(info.event.extendedProps.description);
            // console.log(info.event.id);
            $(".scheduleNo").val(info.event.id);
            $(".scheduleTitle").html(info.event.title);
            $(".scheduleCreateEmployee").html(info.event.extendedProps.emp_name);
            $(".scheduleContent").html(info.event.extendedProps.content);
            switch(info.event.extendedProps.schedule_status){
              case 1:
              $(".scheduleStatus").html("ì—…ë¬´");
              $("#scheduleColorLine").removeAttr("hidden");
              $("#scheduleColorLine").prop("src", "./img/ì—…ë¬´.png");
              break;
              case 2:
              $(".scheduleStatus").html("ì¶œì¥");
              $("#scheduleColorLine").removeAttr("hidden");
              $("#scheduleColorLine").prop("src", "./img/ì¶œì¥.png");
              break;
              case 3:
              $(".scheduleStatus").html("ì—°ì°¨");
              $("#scheduleColorLine").removeAttr("hidden");
              $("#scheduleColorLine").prop("src", "./img/ì—°ì°¨.png");
              break;
              case 4:
              $(".scheduleStatus").html("íŒ€");
              $("#scheduleColorLine").prop("hidden", true);
              if(info.event.extendedProps.dept_id == "1000"){
                $("#scheduleDepartmentColorLine").prop("src", "./img/ì˜ì—…íŒ€.png");
              }else if(info.event.extendedProps.dept_id == "2000"){
                $("#scheduleDepartmentColorLine").prop("src", "./img/ì´ë¬´íŒ€.png");
              }else if(info.event.extendedProps.dept_id == "3000"){
                $("#scheduleDepartmentColorLine").prop("src", "./img/ìë£Œê´€ë¦¬íŒ€.png");
              }else if(info.event.extendedProps.dept_id == "4000"){
                $("#scheduleDepartmentColorLine").prop("src", "./img/ì‚¬ì—…ê´€ë¦¬íŒ€.png");
              }else if(info.event.extendedProps.dept_id == "5000"){
                $("#scheduleDepartmentColorLine").prop("src", "./img/ëª¨ë°”ì¼íŒ€.png");
              }
              break;
            }
            $(".scheduleTime").html((moment(info.event.start).format('YYYY-MM-DD HH:mm')) + " ~ " + (moment(info.event.end).format('YYYY-MM-DD HH:mm')));
            
            if(info.event.extendedProps.filename != undefined){
              $(".scheduleFile").html('<a href="#" class="fileDownload" style ="text-decoration:none;">' + info.event.extendedProps.filename + '</a>');
              $('.fileDownload').prop('href', 'download?filename='+ info.event.extendedProps.filename);
              $(".filePath").val(info.event.extendedProps.filepath);
              filename = info.event.extendedProps.filename;
              filepath = info.event.extendedProps.filepath;
            }else{
              $(".scheduleFile").html("ì—†ìŒ");
              $(".filePath").val("");
              filename = "";
              filepath = "";
            }
            
            if(info.event.extendedProps.dept_id != undefined){
              $("#departmentViewTable").css('display', 'table-row');
              $(".scheduleDepartment").html(info.event.extendedProps.dept_name);
            } else{
              $("#departmentViewTable").css('display', 'none');
            }
            // íŒ€ ì¼ì • ì¤‘ ìê¸°ê°€ ì˜¬ë¦° ì¼ì • ì•„ë‹ˆë©´ ìˆ˜ì •, ì‚­ì œ ì•ˆëœ¨ê²Œ
            if(info.event.extendedProps.emp_id == loginedId){
              $("div.buttonDiv").css('visibility', 'visible');
            }else{
              $("div.buttonDiv").css('visibility', 'hidden');
            }
            $('#element_to_pop_up2').bPopup({
              modalClose: false,
            });
          },
          // ì´ë²¤íŠ¸ í´ë¦­ ë


          eventTimeFormat: { // like '14:30:00'
            hour: '2-digit',
            minute: '2-digit',
            //meridiem: 'short',
            hour12 : false,
          },
        });

        //addEvent removeëŠ” íŠ¸ë¦¬ê±°ê°€ ìˆì„ë•Œë§Œ(ë¬¸ì„œê°€ ì¤€ë¹„ë˜ê³  ë°”ë¡œ í•˜ë ¤ë©´ ìº˜ë¦°ë” ì´ˆê¸°í™”ë¶€ë¶„ì—)

        calendar.render(); //ë‹¬ë ¥ ê·¸ë¦¬ê¸°

        //ì €ì¥ë²„íŠ¼ í´ë¦­
        $("#element_to_pop_up>section>form>div>ul>li>input[type=submit]").click(function(){
            // var $data = $("#newScheduleForm").serialize();
            // var $data = $("#newScheduleForm")[0];
            // íŒŒì¼ í¬ê¸° ì²´í¬
            if($("input[name=uploadFile]").val() != ""){
              if(!fileCheck(this.form.uploadFile)){
                return false;
              }
            }
            
            var $data = $('#newScheduleForm')[0];
            var dataForm = new FormData($data);
            var title = $("input[name=newScheduleTitle]").val();
            var startTime = $("input[name=newScheduleStartTime]").val();
            var endTime = $("input[name=newScheduleEndTime]").val();
            var startDate = $("input[name=newScheduleStartDate]").val();
            var endDate = $("input[name=newScheduleEndDate]").val();
            var correctTime = false;
            var titleCheck = false;
            var annualCheck = true;

            var sdt = new Date(startDate);
            var edt = new Date(endDate);
            var dateDiff = Math.ceil((edt.getTime()-sdt.getTime())/(1000*3600*24));

            if(title.trim() != ''){
              titleCheck = true;
            }

            if(startDate <= endDate){
              if(startDate.valueOf()===endDate.valueOf()){
                if(startTime < endTime){
                  correctTime = true;
                }
              }else{
                correctTime = true;
              }
            }

            if($("#statusBox option:selected").val() == 3){
              if(localStorage.getItem('used_day') < (dateDiff+1)){
                annualCheck = false;
              }
            }           

            if(correctTime && titleCheck && annualCheck){ //ì‹œê°„ì¡°ê±´ , ì œëª©ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
              if($(".trigger").val() == 0){ // ê·¸ëƒ¥ ì €ì¥ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
                $.ajax({
                  url: "./addevent",
                  method: "post",
                  enctype: 'multipart/form-data',
                  dataType : 'json',
                  contentType : false,
                  processData : false,
                  data : dataForm,
                  success: function(responseObj){
                    if(responseObj.status == undefined){
                      if($("#statusBox option:selected").val() != 4) {
                        calendar.getEventSourceById($("#statusBox").val()).refetch();
                      }else{
                        calendar.getEventSourceById(responseObj[0]['dept_id']).refetch();
                      }
                      $("#element_to_pop_up").bPopup().close();
                    }else if(responseObj.status == -1){
                      alert("ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ”ë° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
                    }
                  },
                });
              } else if($(".trigger").val() == 1){ //ìˆ˜ì •í•´ì„œ ì €ì¥ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
                  $.ajax({
                    url: "./updateevent",
                    method: "post",
                    enctype: 'multipart/form-data',
                    dataType : 'json',
                    contentType : false,
                    processData : false,
                    data : dataForm,
                    success: function(responseObj){
                      if(responseObj.status == undefined){
                        if($("#statusBox option:selected").val() != 4) { //ë‚˜ì¤‘ì— ì¡°ê±´ ë°”ê¾¸ê¸° ê°œì¸ì¼ì •ë§Œ refetch
                          if($(".scheduleStatus").text() == "ì—…ë¬´"){
                            calendar.getEventSourceById("1").refetch();
                          } else if($(".scheduleStatus").text() == "ì¶œì¥"){
                            calendar.getEventSourceById("2").refetch();
                          } else if($(".scheduleStatus").text() == "ì—°ì°¨"){
                            calendar.getEventSourceById("3").refetch();
                          }
                          calendar.getEventSourceById($("#statusBox").val()).refetch();
                        }else{
                          calendar.getEventSourceById(responseObj[0]['dept_id']).refetch();
                        }
                        $("#element_to_pop_up").bPopup().close();
                      }else if(responseObj.status == -1){
                        alert("ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ëŠ”ë° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
                      }
                    },
                  });
                }
              } else if(!titleCheck){
                alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”");
                $("input[name=newScheduleTitle]").focus();
              } else if(!correctTime){
                alert("ì¢…ë£Œì‹œê°„ì´ ì‹œì‘ì‹œê°„ë³´ë‹¤ ë¹ ë¦…ë‹ˆë‹¤");
              } else if(!annualCheck){
                alert("ì—°ì°¨ì¼ìˆ˜ê°€ ëª¨ìëë‹ˆë‹¤");
              }
            return false;
          });
          // ì €ì¥ë²„íŠ¼ í´ë¦­ ë



          // ìˆ˜ì •ë²„íŠ¼ í´ë¦­
        $(".updateButton").click(function(){ 
          $("#element_to_pop_up2").bPopup().close();
          $(".trigger").val(1);
          $("input[name=newScheduleNo]").val($(".scheduleNo").val());
          $("input[name=newScheduleTitle]").val($(".scheduleTitle").text());
          if($(".scheduleStatus").text() == "ì—…ë¬´"){
            $("#statusBox").val("1").prop("selected", true);
          } else if($(".scheduleStatus").text() == "ì¶œì¥"){
            $("#statusBox").val("2").prop("selected", true);
          } else if($(".scheduleStatus").text() == "ì—°ì°¨"){
            $("#statusBox").val("3").prop("selected", true);
          } else {
            $("#statusBox").val("4").prop("selected", true);
          }
          var string = $(".scheduleTime").text();
          $("input[name=newScheduleStartDate]").val(string.substring(0,10));
          $("input[name=newScheduleStartTime]").val(string.substring(11, 16));
          $("input[name=newScheduleEndDate]").val(string.substring(19,29));
          $("input[name=newScheduleEndTime]").val(string.substring(30,35));

          var content = document.getElementById("textarea");
          content.value = $(".scheduleContent").text();
          
          var fileValue = $("input[name=uploadFile]").val().split("\\");
          var realfilename = fileValue[fileValue.length-1];
          $("input[name=prevFileName]").val(realfilename);

          if($(".scheduleStatus").text() == "íŒ€"){
            $("#statusBox>.departmentStatus").removeAttr('disabled');
            $("#statusBox>.employeeStatus").attr('disabled', true);
          }else{
            $("#statusBox>.employeeStatus").removeAttr('disabled');
            $("#statusBox>.departmentStatus").attr('disabled', true);
          }
          
          $('#element_to_pop_up').bPopup({
              modalClose: false,
          });
        });

        // ìˆ˜ì •ë²„íŠ¼ í´ë¦­ ë

        //ì‚­ì œë²„íŠ¼ í´ë¦­
        $(".deleteButton").click(function(){
          $('#element_to_pop_up3').bPopup({
              modalClose: false,
          });
        });
        //ì‚­ì œë²„íŠ¼ í´ë¦­ ë

        //ì‚­ì œë²„íŠ¼ í™•ì¸ í´ë¦­
        $("#deleteOK").click(function(){
          var scheduleno = $(".scheduleNo").val();
          var status = 0;
          filepath = $(".filePath").val();
          filename = $(".scheduleFile").text();
          if($(".scheduleStatus").html() == "ì—…ë¬´"){
            status = 1;
          }else if($(".scheduleStatus").html() == "ì¶œì¥"){
            status = 2;
          }else if($(".scheduleStatus").html() == "ì—°ì°¨"){
            status = 3;
          }else if($(".scheduleStatus").html() == "íŒ€"){
            status = 4;
          }
          $.ajax({
            url: "./deleteevent",
            data : {"scheduleNo" : scheduleno, "status" : status, "filepath" : filepath, "filename" : filename},
            success: function(responseObj){
              if(responseObj.status == 0){
                var selectEvent = calendar.getEventById(scheduleno);
                selectEvent.remove();
                $("#element_to_pop_up2").bPopup().close();
                $("#element_to_pop_up3").bPopup().close();
                $("#element_to_pop_up4").bPopup({
                  modalClose: false,
                });
              }else if(responseObj.status == -1){
                $("#element_to_pop_up5").bPopup({
                  modalClose: false,
                });
              }
            },
          });
          return false;
        });
        //ì‚­ì œë²„íŠ¼ í™•ì¸ í´ë¦­ ë


        // ì‚­ì œë˜ì—ˆì„ë•Œ ëª¨ë‹¬ì°½ í™•ì¸ í´ë¦­
        $("#deleteConform").click(function(){
          $("#element_to_pop_up2").bPopup().close();
          $("#element_to_pop_up4").bPopup().close();
        });
        // ì‚­ì œë˜ì—ˆì„ë•Œ ëª¨ë‹¬ì°½ í™•ì¸ í´ë¦­ ë

        // ì‚­ì œ ì˜¤ë¥˜ ë–´ì„ë•Œ í™•ì¸ í´ë¦­
        $("#deleteError").click(function(){
          $("#element_to_pop_up3").bPopup().close();
          $("#element_to_pop_up5").bPopup().close();
        });
        // ì‚­ì œ ì˜¤ë¥˜ ë–´ì„ë•Œ í™•ì¸ í´ë¦­ ë

        //ê°œì¸ì¼ì • ì²´í¬ë°•ìŠ¤ê°€ ë³€ê²½
        $("div.employeeCheckBoxDiv input[type=checkbox]").change(function(event){
          if($(event.target).prop("checked")){
            // statusArr.splice($(event.target).val()-1,0,$(event.target).val());
            if($(event.target).val() == 1){
              empcheckedArr[0] = "1";
            }else if($(event.target).val() == 2){
              empcheckedArr[1] = "1";
            }else if($(event.target).val() == 3){
              empcheckedArr[2] = "1";
            }
          }else{
            // statusArr.splice(status.includes($(event.target).val()),1);
            if($(event.target).val() == 1){
              empcheckedArr[0] = "2";
            }else if($(event.target).val() == 2){
              empcheckedArr[1] = "2";
            }else if($(event.target).val() == 3){
              empcheckedArr[2] = "2";
            }
          }
          calendar.getEventSourceById($(event.target).val()).refetch();
          return false;        
        });
        //ê°œì¸ì¼ì • ì²´í¬ë°•ìŠ¤ê°€ ë³€ê²½ ë

        //ë¶€ì„œì¼ì • ì²´í¬ë°•ìŠ¤ê°€ ë³€ê²½
        $("div.departmentCheckBoxDiv input[type=checkbox]").change(function(event){
          var eventSource = calendar.getEventSourceById($(event.target).val());
          // var eventArr = eventSource.getEvents();
          if($(event.target).prop("checked")){
            // calendar.addEventSource( source )
            // eventSource.addEvent(eventArr, calendar.getEventSourceById($(event.target).val()));
            if($(event.target).val() == 1000){
              checkedArr[0] = "1";
            }else if($(event.target).val() == 2000){
              checkedArr[1] = "1";
            }else if($(event.target).val() == 3000){
              checkedArr[2] = "1";
            }else if($(event.target).val() == 4000){
              checkedArr[3] = "1";
            }else if($(event.target).val() == 5000){
              checkedArr[4] = "1";
            }
          }else{
            if($(event.target).val() == 1000){
              checkedArr[0] = "2";
            }else if($(event.target).val() == 2000){
              checkedArr[1] = "2";
            }else if($(event.target).val() == 3000){
              checkedArr[2] = "2";
            }else if($(event.target).val() == 4000){
              checkedArr[3] = "2";
            }else if($(event.target).val() == 5000){
              checkedArr[4] = "2";
            }
          }
          eventSource.refetch();
          return false;
        });
        //ë¶€ì„œì¼ì • ì²´í¬ë°•ìŠ¤ê°€ ë³€ê²½ ë

        //ëª¨ë‹¬ì°½ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ê²Œ
        $('#element_to_pop_up').draggable({'cancel':'#modalBody1', containment:'parent', scroll:false});
        $('#element_to_pop_up2').draggable({'cancel':'#modalBody2', containment:'parent', scroll:false});
        $('#element_to_pop_up3').draggable({'cancel':'#modalBody3, .modalFooter', containment:'parent', scroll:false});
        $('#element_to_pop_up4').draggable({'cancel':'#modalBody4, .modalFooter', containment:'parent', scroll:false});
        $('#element_to_pop_up5').draggable({'cancel':'#modalBody5, .modalFooter', containment:'parent', scroll:false}); // containment:'parent'


      });
    </script>
  </head>

  <div id="calendarBody">
    <div class="employeeCheckBoxDiv">
      <ul>
        <li><span>ì—…ë¬´</span><span><input id="employeestatusCheckBox1"  type="checkbox" checked value = 1></li>
        <li><span>ì¶œì¥</span><span><input id="employeestatusCheckBox2"  type="checkbox" checked value = 2></li>
        <li><span>ì—°ì°¨</span><span><input id="employeestatusCheckBox3"  type="checkbox" checked value = 3></li>
      </ul>
    </div>
    <!--ë‹¬ë ¥ div-->
    <div id='calendar'></div>

    <div class="departmentCheckBoxDiv">
      <ul>
        <li><div class="deptDiv"><input id="departmentStatusCheckBox1" type="checkbox" checked value = 1000><span>ì˜ì—…íŒ€</span><img src="./img/ì˜ì—…íŒ€.png" class="deptColorLine"></div></li>
        <li><div class="deptDiv"><input id="departmentStatusCheckBox2" type="checkbox" checked value = 2000><span>ì´ë¬´íŒ€</span><img src="./img/ì´ë¬´íŒ€.png" class="deptColorLine"></div></li>
        <li><div class="deptDiv"><input id="departmentStatusCheckBox3" type="checkbox" checked value = 3000><span>ìë£Œê´€ë¦¬íŒ€</span><img src="./img/ìë£Œê´€ë¦¬íŒ€.png" class="deptColorLine"></div></li>
        <li><div class="deptDiv"><input id="departmentStatusCheckBox4" type="checkbox" checked value = 4000><span>ì‚¬ì—…ê´€ë¦¬íŒ€</span><img src="./img/ì‚¬ì—…ê´€ë¦¬íŒ€.png" class="deptColorLine"></div></li>
        <li><div class="deptDiv"><input id="departmentStatusCheckBox5" type="checkbox" checked value = 5000><span>ëª¨ë°”ì¼íŒ€</span><img src="./img/ëª¨ë°”ì¼íŒ€.png" class="deptColorLine"></div></li>
      </ul>
    </div>
  </div>

  <div id="element_to_pop_up">
    <header class="modalHeader">
      <h2 class="title">ì¼ì •ë“±ë¡</h2>
      <a class="b-close" id="modalClose1">ë‹«ê¸°</a>
    </header>
    <section class="modalBody" id="modalBody1">
      <form id="newScheduleForm" method="POST">
        <div class="saveButtonDiv">
          <ul>
            <li><input type="submit" value="ì €ì¥" class="saveButton"></li>
          </ul>
        </div>
        <article class=scheduleArticle>
          <table class="newScheduleTable">
            <tbody>
              <input type="text" name="newScheduleNo" hidden value="0">
              <tr><th>ì œëª©</th><td><input style="width:100%;height:100%;border:1px;padding:0px;" type="text" name="newScheduleTitle" maxlength="100" title="ì œëª©" required></td></tr>
              <tr><th>ì¼ì •</th>
                <td>
                  <select id="statusBox" style="width:100%;height:100%;" name="newScheduleStatus">
                    <option value="1" class="employeeStatus">ì—…ë¬´</option>
                    <option value="2" class="employeeStatus">ì¶œì¥</option>
                    <option value="3" class="employeeStatus">ì—°ì°¨</option>
                    <option value="4" class="departmentStatus">íŒ€</option>
                  </select>
                </td>
              </tr>
              <tr><th>ì¼ì •ì‹œê°„</th>
                <td>
                  <ul class="timeList">
                    <li><input type="date" name="newScheduleStartDate"></li>
                    <li><input type="time" name="newScheduleStartTime"></li>
                    <li><label>~</label></li>
                    <li><input type="date" name="newScheduleEndDate"></li>
                    <li><input type="time" name="newScheduleEndTime"></li>
                  </ul>
                </td>
              </tr>
              <tr><th>ë‚´ìš©</th><td><textarea id="textarea" style="width:100%;height:100%;padding:0px;" name="newScheduleContent" rows="7" maxlength="500" title="ë‚´ìš©"></textarea></td></tr>
              <!-- <tr><th>ì¥ì†Œ</th><td><input style="width:100%;vertical-align: middle;" type="text" name="newSchedulePlace" title="ì¥ì†Œ"></td></tr> -->
              <tr><th>ì²¨ë¶€íŒŒì¼</th><td><input type="file" name="uploadFile" title="ì²¨ë¶€íŒŒì¼"></td></tr>
              <tr hidden><td><input type="text" name="prevFileName"></td></tr>
            </tbody>
          </table>
        </article>
      </form>
    </section>
  </div>

  <div id="element_to_pop_up2">
    <header class="modalHeader">
      <h2 class="title" id="title2">ì¼ì •ì¡°íšŒ</h2>
      <a class="b-close" id="modalClose2">ë‹«ê¸°</a>
    </header>
    <section class="modalBody" id="modalBody2">
        <div class="buttonDiv">
          <ul id="modalUl2">
            <li><input type="button" value="ì‚­ì œ" class="deleteButton"></li>
            <li><input type="button" value="ìˆ˜ì •" class="updateButton"></li>
          </ul>
        </div>
        <article class=scheduleArticle>
          <table class="scheduleTable">
            <tbody>
              <span class="trigger" hidden value="0"></span>
              <span class="scheduleNo" hidden value="0"></span>
              <span class="filePath" hidden value=""></span>
              <tr><th>ì œëª©</th><td><div style="width:380px;vertical-align: middle;" class="scheduleTitle">ì œëª© í…ìŠ¤íŠ¸</div></td></tr>
              <tr><th>ì‘ì„±ì</th><td><div class="scheduleCreateEmployee">ì‘ì„±ì</div></td></tr>
              <tr><th>ë‚´ìš©</th><td><pre style="width:100%;max-height:60px;overflow:auto;white-space: pre-wrap;vertical-align:middle;" class="scheduleContent"></pre></td></tr>
              <tr id="departmentViewTable" style="display:none"><th>ë¶€ì„œ</th><td><img id="scheduleDepartmentColorLine"><span class="scheduleDepartment"></span></td></tr>
              <tr><th>ì¼ì •</th><td><img id="scheduleColorLine"><span class="scheduleStatus"></span></td></tr>
              <tr><th>ì¼ì •ì‹œê°„</th><td><div class="scheduleTime">ì‹œê°„</div></td></tr>
              <tr><th>ì²¨ë¶€íŒŒì¼</th><td><div class="scheduleFile">ì—†ìŒ</div></td></tr>
            </tbody>
          </table>
        </article>
    </section>
  </div>

  <div id="element_to_pop_up3">
    <header class="modalHeader" >
      <h3 class="title" style="padding:0px;">ì‚­ì œ</h2>
      <a class="b-close" id="modalClose3">ë‹«ê¸°</a>
    </header>
    <section class="modalBody" id="modalBody3">
      <div style="height:100%;">
        ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
      </div>
    </section>
    <footer class="modalFooter">
      <li style="list-style-type:none;float:right;margin:5px;"><input type="button" value="ì·¨ì†Œ" class="b-close"></li>
      <li style="list-style-type:none;float:right;margin:5px;"><input type="button" value="ì‚­ì œ" id="deleteOK"></li>
    </footer>
  </div>

  <div id="element_to_pop_up4">
    <header class="modalHeader" id="modalHeader4">
      <h2 class="title">ì •ë³´</h2>
    </header>
    <section class="modalBody" id="modalBody4">
      <div style="height:100%;">
        ì •ìƒì ìœ¼ë¡œ ì‚­ì œ ë˜ì—ˆìŠµë‹ˆë‹¤.
      </div>
    </section>
    <footer class="modalFooter">
      <li style="list-style-type:none;float:right;margin:5px;"><input type="button" value="í™•ì¸" id="deleteConform"></li>
    </footer>
  </div>

  <div id="element_to_pop_up5">
    <header class="modalHeader" id="modalHeader5">
      <h2 class="title">ì‚­ì œì‹¤íŒ¨</h2>
    </header>
    <section class="modalBody" id="modalBody5">
      <div style="height:100%;">
        ì˜¤ë¥˜ê°€ ë°œìƒí•´ ì‚­ì œê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
      </div>
    </section>
    <footer class="modalFooter">
      <li style="list-style-type:none;float:right;margin:5px;"><input type="button" value="í™•ì¸" id="deleteError"></li>
    </footer>
  </div>
</html>